â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              ğŸ½ï¸  REEL GALLERY BACKEND â€” COMPLETE FLOW GUIDE                     â•‘
â•‘                  Understanding every function, file, and data path              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  SECTION 1: FOLDER STRUCTURE EXPLAINED
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  reel-gallery-backend/
  â”‚
  â”œâ”€â”€ server.js                 â† Entry point. Boots Express, registers middleware & routes.
  â”‚
  â”œâ”€â”€ config/
  â”‚   â”œâ”€â”€ db.js                 â† Creates and exports a PostgreSQL connection pool (pg.Pool).
  â”‚   â”œâ”€â”€ cloudinary.js         â† Configures Cloudinary SDK using env variables.
  â”‚   â””â”€â”€ multer.js             â† Configures Multer with memory storage (no disk writes).
  â”‚
  â”œâ”€â”€ routes/
  â”‚   â”œâ”€â”€ restaurant.routes.js  â† Maps HTTP verbs + paths to restaurant controller functions.
  â”‚   â””â”€â”€ reel.routes.js        â† Maps HTTP verbs + paths to reel controller functions.
  â”‚                               Also wires Multer middleware for the upload endpoint.
  â”‚
  â”œâ”€â”€ controllers/
  â”‚   â”œâ”€â”€ restaurant.controller.js â† Business logic for restaurant endpoints.
  â”‚   â””â”€â”€ reel.controller.js       â† Business logic for reel endpoints (incl. Cloudinary upload).
  â”‚
  â”œâ”€â”€ models/
  â”‚   â”œâ”€â”€ restaurant.model.js   â† Raw SQL queries for the restaurants table.
  â”‚   â””â”€â”€ reel.model.js         â† Raw SQL queries for the reels table.
  â”‚
  â”œâ”€â”€ schema.sql                â† Run once to create tables in PostgreSQL.
  â”œâ”€â”€ .env.example              â† Template for environment variables.
  â””â”€â”€ package.json              â† Project dependencies and npm scripts.


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  SECTION 2: ALL FUNCTIONS EXPLAINED
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  config/db.js                                                   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  pool (pg.Pool)                                                 â”‚
  â”‚    â†’ Creates a shared connection pool to PostgreSQL.            â”‚
  â”‚    â†’ All models import this pool to run queries.                â”‚
  â”‚    â†’ Reads DATABASE_URL from .env                               â”‚
  â”‚    â†’ In production: adds SSL config (required for Render/Neon)  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  config/cloudinary.js                                           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  cloudinary.config()                                            â”‚
  â”‚    â†’ Reads CLOUDINARY_CLOUD_NAME, API_KEY, API_SECRET from .env â”‚
  â”‚    â†’ Exports the configured Cloudinary v2 instance              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  config/multer.js                                               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  upload (multer instance)                                       â”‚
  â”‚    â†’ Uses memoryStorage() â€” file stays as Buffer in RAM         â”‚
  â”‚    â†’ Rejects non-video MIME types                               â”‚
  â”‚    â†’ Limits file size to 100 MB                                 â”‚
  â”‚    â†’ Exported and used as middleware in reel.routes.js          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  models/restaurant.model.js                                     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  createRestaurant({ name, location, description })              â”‚
  â”‚    â†’ Runs INSERT INTO restaurants ... RETURNING *               â”‚
  â”‚    â†’ UUID generated by PostgreSQL gen_random_uuid()             â”‚
  â”‚    â†’ Returns the newly created restaurant row                   â”‚
  â”‚                                                                 â”‚
  â”‚  getAllRestaurants()                                             â”‚
  â”‚    â†’ Runs SELECT * FROM restaurants ORDER BY created_at DESC    â”‚
  â”‚    â†’ Returns array of all restaurant rows                       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  models/reel.model.js                                           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  createReel({ restaurantId, videoUrl })                         â”‚
  â”‚    â†’ Runs INSERT INTO reels ... RETURNING *                     â”‚
  â”‚    â†’ Stores Cloudinary secure_url as video_url                  â”‚
  â”‚    â†’ Returns the newly created reel row                         â”‚
  â”‚                                                                 â”‚
  â”‚  getAllReels()                                                   â”‚
  â”‚    â†’ JOINs reels with restaurants                               â”‚
  â”‚    â†’ Returns id, video_url, likes, views, created_at,          â”‚
  â”‚              restaurant_name, restaurant_location               â”‚
  â”‚    â†’ Sorted newest first                                        â”‚
  â”‚                                                                 â”‚
  â”‚  incrementViews(id)                                             â”‚
  â”‚    â†’ UPDATE reels SET views = views + 1 WHERE id = $1          â”‚
  â”‚    â†’ Returns updated reel row (or undefined if not found)       â”‚
  â”‚                                                                 â”‚
  â”‚  incrementLikes(id)                                             â”‚
  â”‚    â†’ UPDATE reels SET likes = likes + 1 WHERE id = $1          â”‚
  â”‚    â†’ Returns updated reel row (or undefined if not found)       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  controllers/restaurant.controller.js                           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  addRestaurant(req, res)                                        â”‚
  â”‚    â†’ Validates that `name` exists in req.body                   â”‚
  â”‚    â†’ Calls createRestaurant() model function                    â”‚
  â”‚    â†’ Returns 201 + created restaurant                           â”‚
  â”‚    â†’ Returns 400 if name missing, 500 on DB error               â”‚
  â”‚                                                                 â”‚
  â”‚  getRestaurants(req, res)                                       â”‚
  â”‚    â†’ Calls getAllRestaurants() model function                    â”‚
  â”‚    â†’ Returns 200 + array of restaurants                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  controllers/reel.controller.js                                 â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  uploadToCloudinary(buffer)   [private helper]                  â”‚
  â”‚    â†’ Wraps cloudinary.uploader.upload_stream in a Promise       â”‚
  â”‚    â†’ Pipes the in-memory Buffer directly to Cloudinary          â”‚
  â”‚    â†’ resource_type: "video", folder: "reel-gallery"             â”‚
  â”‚    â†’ Returns Cloudinary result (includes secure_url)            â”‚
  â”‚                                                                 â”‚
  â”‚  uploadReel(req, res)                                           â”‚
  â”‚    â†’ Validates restaurantId exists in req.body                  â”‚
  â”‚    â†’ Validates req.file exists (Multer puts file here)          â”‚
  â”‚    â†’ Calls uploadToCloudinary(req.file.buffer)                  â”‚
  â”‚    â†’ Calls createReel() with restaurantId + secure_url          â”‚
  â”‚    â†’ Returns 201 + created reel                                 â”‚
  â”‚    â†’ Returns 400 if fields missing, 500 on upload/DB error      â”‚
  â”‚                                                                 â”‚
  â”‚  getReels(req, res)                                             â”‚
  â”‚    â†’ Calls getAllReels() model function                          â”‚
  â”‚    â†’ Returns 200 + enriched reel array                          â”‚
  â”‚                                                                 â”‚
  â”‚  viewReel(req, res)                                             â”‚
  â”‚    â†’ Extracts id from req.params                                â”‚
  â”‚    â†’ Calls incrementViews(id)                                   â”‚
  â”‚    â†’ Returns 200 + updated reel, or 404 if not found            â”‚
  â”‚                                                                 â”‚
  â”‚  likeReel(req, res)                                             â”‚
  â”‚    â†’ Extracts id from req.params                                â”‚
  â”‚    â†’ Calls incrementLikes(id)                                   â”‚
  â”‚    â†’ Returns 200 + updated reel, or 404 if not found            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  SECTION 3: ARCHITECTURE DIAGRAM
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  CLIENT (Mobile App / Web / Postman)
       â”‚
       â”‚  HTTP Request (JSON or multipart/form-data)
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                        server.js                           â”‚
  â”‚   - Loads .env                                             â”‚
  â”‚   - Boots Express                                          â”‚
  â”‚   - Registers CORS, express.json()                         â”‚
  â”‚   - Mounts /api/restaurants â†’ restaurant.routes.js         â”‚
  â”‚   - Mounts /api/reels       â†’ reel.routes.js               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                                    â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ restaurant.routes â”‚             â”‚    reel.routes       â”‚
  â”‚                   â”‚             â”‚                      â”‚
  â”‚ POST /            â”‚             â”‚ POST /               â”‚
  â”‚  â†’ addRestaurant  â”‚             â”‚  â†’ Multer middleware â”‚
  â”‚                   â”‚             â”‚  â†’ uploadReel        â”‚
  â”‚ GET  /            â”‚             â”‚                      â”‚
  â”‚  â†’ getRestaurants â”‚             â”‚ GET  /               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â†’ getReels          â”‚
           â”‚                        â”‚                      â”‚
           â”‚                        â”‚ POST /:id/view       â”‚
           â”‚                        â”‚  â†’ viewReel          â”‚
           â”‚                        â”‚                      â”‚
           â”‚                        â”‚ POST /:id/like       â”‚
           â”‚                        â”‚  â†’ likeReel          â”‚
           â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                   â”‚
           â–¼                                   â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  restaurant.controller â”‚    â”‚      reel.controller         â”‚
  â”‚                        â”‚    â”‚                              â”‚
  â”‚  addRestaurant()       â”‚    â”‚  uploadReel()                â”‚
  â”‚   â†’ validates name     â”‚    â”‚   â†’ validates fields         â”‚
  â”‚   â†’ calls model        â”‚    â”‚   â†’ calls uploadToCloudinary â”‚
  â”‚                        â”‚    â”‚   â†’ calls model              â”‚
  â”‚  getRestaurants()      â”‚    â”‚                              â”‚
  â”‚   â†’ calls model        â”‚    â”‚  getReels()                  â”‚
  â”‚                        â”‚    â”‚   â†’ calls model              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                              â”‚
             â”‚                  â”‚  viewReel() / likeReel()     â”‚
             â”‚                  â”‚   â†’ calls model              â”‚
             â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                             â”‚
             â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚              â”‚                                 â”‚
             â”‚              â–¼                                 â–¼
             â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚    â”‚   Cloudinary     â”‚          â”‚   reel.model.js    â”‚
             â”‚    â”‚   (video CDN)    â”‚          â”‚                    â”‚
             â”‚    â”‚                  â”‚          â”‚  createReel()      â”‚
             â”‚    â”‚ upload_stream()  â”‚          â”‚  getAllReels()      â”‚
             â”‚    â”‚  â† Buffer from   â”‚          â”‚  incrementViews()  â”‚
             â”‚    â”‚    Multer        â”‚          â”‚  incrementLikes()  â”‚
             â”‚    â”‚  â†’ secure_url    â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
             â”‚                                           â”‚
             â–¼                                           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ restaurant.model.js   â”‚              â”‚       PostgreSQL DB        â”‚
  â”‚                       â”‚              â”‚                           â”‚
  â”‚  createRestaurant()   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  TABLE: restaurants       â”‚
  â”‚  getAllRestaurants()   â”‚              â”‚    id, name, location,    â”‚
  â”‚                       â”‚              â”‚    description, created_atâ”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                           â”‚
                                         â”‚  TABLE: reels             â”‚
                                         â”‚    id, restaurant_id,     â”‚
                                         â”‚    video_url, likes,      â”‚
                                         â”‚    views, created_at      â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  SECTION 4: REQUEST LIFECYCLE â€” STEP BY STEP
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Example: POST /api/reels (upload a video reel)

  Step 1  â†’ Client sends multipart/form-data with `video` + `restaurantId`
  Step 2  â†’ Express receives request, routes to reel.routes.js
  Step 3  â†’ Multer middleware runs first:
              - Reads the file from the request stream
              - Stores it in memory as req.file.buffer
  Step 4  â†’ uploadReel() controller is called
  Step 5  â†’ Validates restaurantId and req.file exist
  Step 6  â†’ Calls uploadToCloudinary(req.file.buffer)
              - Creates a Cloudinary upload stream
              - Pipes the buffer into it
              - Cloudinary processes and stores the video
              - Returns { secure_url, public_id, ... }
  Step 7  â†’ Calls createReel({ restaurantId, videoUrl: secure_url })
              - Runs SQL INSERT into reels table
              - Returns the new reel row
  Step 8  â†’ Controller sends 201 response with reel data
  Step 9  â†’ Client receives { success: true, data: { id, video_url, ... } }


  Example: GET /api/reels

  Step 1  â†’ Client sends GET /api/reels
  Step 2  â†’ Routes to getReels() controller
  Step 3  â†’ Calls getAllReels() model function
  Step 4  â†’ SQL JOIN query runs:
              SELECT r.*, res.name, res.location FROM reels r
              JOIN restaurants res ON r.restaurant_id = res.id
              ORDER BY r.created_at DESC
  Step 5  â†’ Returns array of enriched reel objects
  Step 6  â†’ Controller sends 200 response with array


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  SECTION 5: API REFERENCE QUICK CARD
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  METHOD  ENDPOINT                  BODY / PARAMS               RETURNS
  â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  POST    /api/restaurants          JSON: name, location, desc  201 + restaurant object
  GET     /api/restaurants          â€”                           200 + array
  POST    /api/reels                form-data: video, restaurantId  201 + reel object
  GET     /api/reels                â€”                           200 + enriched array
  POST    /api/reels/:id/view       URL param: id               200 + updated reel
  POST    /api/reels/:id/like       URL param: id               200 + updated reel


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  SECTION 6: HOW TO RUN LOCALLY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Prerequisites:
    - Node.js v18+
    - PostgreSQL running locally (or use Neon.tech free tier)
    - Cloudinary account (free tier is fine)

  Steps:

  1. Clone or download the project
       cd reel-gallery-backend

  2. Install dependencies
       npm install

  3. Set up environment variables
       cp .env.example .env
       # Fill in DATABASE_URL and Cloudinary credentials

  4. Create database tables
       Open your PostgreSQL client (psql or pgAdmin or Neon dashboard)
       Copy and paste the contents of schema.sql and run it

  5. Start the server
       Development (with auto-reload):
         npm run dev

       Production:
         npm start

  6. Test with Postman or curl
       POST http://localhost:5000/api/restaurants
         Body (JSON): { "name": "La Bella", "location": "Mumbai" }

       POST http://localhost:5000/api/reels
         Body (form-data):
           restaurantId: <uuid from above>
           video: <select a .mp4 file>

       GET  http://localhost:5000/api/reels


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  SECTION 7: HOW TO DEPLOY ON RENDER
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Step 1: Push code to GitHub
    git init
    git add .
    git commit -m "initial commit"
    git remote add origin https://github.com/YOUR_USERNAME/reel-gallery-backend.git
    git push -u origin main

  Step 2: Create PostgreSQL database on Render
    â†’ Go to render.com â†’ New â†’ PostgreSQL
    â†’ Note the "External Database URL" â€” this is your DATABASE_URL

  Step 3: Run schema.sql on the Render DB
    â†’ In Render dashboard, open the database shell
    â†’ Paste and run the contents of schema.sql

  Step 4: Create a Web Service on Render
    â†’ New â†’ Web Service â†’ Connect your GitHub repo
    â†’ Settings:
        Runtime:      Node
        Build Command: npm install
        Start Command: npm start
    â†’ Add Environment Variables:
        NODE_ENV              = production
        DATABASE_URL          = (paste from Step 2)
        CLOUDINARY_CLOUD_NAME = your_value
        CLOUDINARY_API_KEY    = your_value
        CLOUDINARY_API_SECRET = your_value

  Step 5: Deploy
    â†’ Click "Create Web Service"
    â†’ Render builds and deploys automatically
    â†’ Your API is live at: https://your-service-name.onrender.com


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  SECTION 8: KEY DESIGN DECISIONS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  1. MEMORY STORAGE (not disk storage) for Multer
     â†’ Files never touch the server's disk
     â†’ Buffer is piped directly to Cloudinary via upload_stream
     â†’ This works on Render (which has an ephemeral filesystem)

  2. upload_stream wrapped in a Promise
     â†’ Cloudinary's upload_stream uses callbacks, not Promises
     â†’ We wrap it so we can use async/await cleanly in the controller

  3. PostgreSQL UUID via gen_random_uuid()
     â†’ IDs are generated by the DB, not the app layer
     â†’ Safer, avoids ID conflicts in distributed scenarios

  4. ON DELETE CASCADE on reels.restaurant_id
     â†’ Deleting a restaurant auto-deletes all its reels
     â†’ No orphan data

  5. Connection pooling (pg.Pool)
     â†’ Efficient: reuses connections instead of creating one per query
     â†’ Handles concurrent requests properly

  6. SSL forced in production
     â†’ Render, Neon, Supabase all require SSL for DB connections
     â†’ The { rejectUnauthorized: false } flag handles self-signed certs

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
